<!DOCTYPE html>
<html lang="en">

<script type="text/javascript">
function findTotal() {
	var arr = document.getElementsByName('phone_tot');
	var tot=0;
	for(var i=0;i<arr.length;i++){
		if(parseInt(arr[i].value))
			tot += parseInt(arr[i].value);
		};
		document.getElementById('total').value = tot;
};
</script>

<head>
	<title>Sales Rep</title>
	<%- include header.ejs %>
</head>

<script type="text/javascript">
$(document).ready(function() {
	$("#post-btn").click(function() {
		var conceptName = $('#custs').find(":selected").text();
		var cName = String(conceptName).split(",");
		console.log(cName[0]);
		$("#customerId").val(cName[0]);
		$.post("/order/placeBusinessOrder", $("#post-form").serialize(), alert("Order has been placed"));
	});
});
</script>

<body>
	<%- include employee-navbar.ejs %>
	<div class='container topSpacing'>
		<div class="w3-container">
			<div class="row">
				<form class="col s12" id="post-form">
					<input type="hidden" id="customerId" name="customerId"></input>

						<h4>Place Business Order</h4>
						<div class="row">
							<div class="input-field col s6">
							<select class="browser-default" id="custs">
							<option value="" disabled selected>Select Business Customer</option>
									<% customers.forEach(function(customer) { %>
									<option><%= customer.id %>, <%= customer.lastName %>, <%=customer.firstName %></option>
									<% }); %>
							</select>
							</div>
							<div class="input-field col s6">
								<a class="btn-floating btn-small waves-effect waves-light red" href="/newCustomer"><i class="material-icons">add</i></a>
							</div>
						</div>

						<div class='sectionSpacer'></div>

						<label style="font-size:1.5rem;color:#000000;">Choose Phone Models</label>
						<div class="row" style='margin:auto;'>
							<ul class="collection with-header phoneList">
								<% if(phoneModels.length == 0) { %>
									<li class="collection-item">
										Opps, failed to load the phone models. Please try again later
									</li>
								<% } %>
								<% phoneModels.forEach(function(phoneModel) { %>
								<li class="collection-item">
									<%= phoneModel.description %>
									<a href="#!" class="secondary-content">
											<label><%= '$' + phoneModel.price %></label>
									<input onblur="findTotal()" id="phoneCount" value=0 name="phone[<%= phoneModel.id %>][quantity]" type="text" class="validate phoneCount"/><br>
									</a>
									<div style='clear:both;'></div>
								</li>
								<% }); %>
							</ul>
						</div>

						<div class='sectionSpacer'></div>

						<button class="btn waves-effect waves-light" id="post-btn" type="submit">Place Order
						<i class="material-icons right">send</i>
					</button>
				</form>
			</div>
		</div>
	</div>
</body>
</html>
