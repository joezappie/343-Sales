<!DOCTYPE html>
<html lang="en">
<head>
	<title>Sales Homepage - Checkout</title>
	<%- include header.ejs %>
</head>
<script src="assets/js/shoppingCart.js"></script>
<script>
	function useBillingInfo()
	{
		if (document.getElementById("shipping_is_billing").checked == true)
		{
			//store values if we uncheck
			shippingFirstName = document.getElementById("shipping_first_name").value;
			shippingLastName = document.getElementById("shipping_last_name").value;
			shippingStreetAddress = document.getElementById("shipping_street_address").value;
			shippingCity = document.getElementById("shipping_city").value;
			shippingZipCode = document.getElementById("shipping_zip_code").value;
			shippingState = document.getElementById("shipping_state").value;

			//set shipping to billing
			document.getElementById("shipping_first_name").value = document.getElementById("billing_first_name").value;
			document.getElementById("shipping_last_name").value = document.getElementById("billing_last_name").value;
			document.getElementById("shipping_street_address").value = document.getElementById("billing_street_address").value;
			document.getElementById("shipping_city").value = document.getElementById("billing_city").value;
			document.getElementById("shipping_zip_code").value = document.getElementById("billing_zip_code").value;
			document.getElementById("shipping_state").value = document.getElementById("billing_state").value;

			//update dropdown menu with new value
			$('select').material_select();

			//redraw labels so they don't overlap with text
			Materialize.updateTextFields()
		}
		else
		{
			//restore stored values
			document.getElementById("shipping_first_name").value = shippingFirstName;
			document.getElementById("shipping_last_name").value = shippingLastName;
			document.getElementById("shipping_street_address").value = shippingStreetAddress;
			document.getElementById("shipping_city").value = shippingCity;
			document.getElementById("shipping_zip_code").value = shippingZipCode;
			document.getElementById("shipping_state").value = shippingState;

			//update dropdown menu with new value
			$('select').material_select();

			//redraw labels so they don't overlap with text
			Materialize.updateTextFields()
		}
	}
	
	$(document).ready(function() {
		$('select').material_select();
		
		$( "#placeOrderForm" ).submit(function( event ) {
			$("#placeOrderForm .invalid").removeClass("invalid");
			
			$.post("api/order/placeOrder", $("#placeOrderForm").serialize(), function( response ) {
				console.log(response);
				if(response.hasOwnProperty("success") && response.success) {
					Materialize.toast('New Order Placed', 4000);
					$("#post-form").trigger("reset");
					onCustomerSelected();
				} else if(response.hasOwnProperty("errors")) {
					for(var input in response.errors) {
						var element = $("#" + input);
						
						if(element.is("select")) {
							element = element.siblings("input");
						}
						
						element.addClass("invalid");
						element.siblings("label").attr("data-error", response.errors[input]);
					};
				}
				
				$(window).scrollTop(0);
				
			}, "json");
			
			event.preventDefault();
		});

	});
</script>
<body>
	<%- include consumer-navbar.ejs %>
	<div class="container storeContainer" >
		<nav class="storeBreadcrumbs transparent">
			<div class="nav-wrapper">
				<div class="col s12">
					<a href="/" class="breadcrumb">Browse Phones</a>
					<a href="/shoppingCart" class="breadcrumb">Shopping Cart</a>
					<a href="/customerCheckout" class="breadcrumb">Checkout</a>
				</div>
			</div>
		</nav>
		<div class="row">
			<form id='placeOrderForm' class="col s12">
				<div class="col s8">
					<div class="row">
						<h5>Credit Card Information:</h5>
					</div>
					<div class="row">
						<div class="input-field col s5">
							<label for="card_number" >Credit Card Number</label>
							<input id="card_number" name="card_number" type="text" class="validate"/>
						</div>
						<div class="input-field col s2">
							<Label for="billing_first_name">First Name</Label>
							<input id="billing_first_name" name="billing_first_name" type="text" class="validate"/>
						</div>
						<div class="input-field col s3">
							<Label for="billing_last_name">Last Name</Label>
							<input id="billing_last_name" name="billing_last_name" type="text" class="validate"/>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s2">
							<label for="cvc">Security Code</label>
							<input id="cvc" name="cvc" type="text" style="text-align:center;" class="validate"/>
						</div>
						<div class="input-field col s2 offset-s1" style="text-align:right;">
							<label>Expiration:</label>
						</div>
						<div class="input-field col s3">
							<select id="expiration_month" name="expiration_month">
								<option value="" disabled selected>Month</option>
								<option value="1">01 - January</option>
								<option value="2">02 - Febrary</option>
								<option value="3">03 - March</option>
								<option value="4">04 - April</option>
								<option value="5">05 - May</option>
								<option value="6">06 - June</option>
								<option value="7">07 - July</option>
								<option value="8">08 - August</option>
								<option value="9">09 - September</option>
								<option value="10">10 - October</option>
								<option value="11">11 - November</option>
								<option value="12">12 - December</option>
							</select>
						</div>
						<div class="input-field col s2">
							<select name='expiration_year' id="expiration_year" class='validate'>
								<option value="" disabled selected>Year</option>
								<% for(var i=new Date().getFullYear(); i< new Date().getFullYear() + 15; i++) {%>
								   <option value="<%= i %>"><%= i %></option>
								<% } %>
							</select>
						</div>
					</div>
					<div class="row">
						<h5>Billing Address:</h5>
					</div>
					<div class="row">
						<div class="input-field col s5">
							<Label for="billing_address">Street Address</Label>
							<input id="billing_address" name="billing_address" type="text" class="validate"/>
						</div>
						<div class="input-field col s5">
							<Label for="billing_city">City</Label>
							<input id="billing_city" name="billing_city" type="text" class="validate"/>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s3">
							<Label for="billing_zip_code">Zip Code</Label>
							<input id="billing_zip_code" name="billing_zip_code" type="text" class="validate"/>
						</div>
						<div class="input-field col s2 offset-s1">
							<label>State:</label>
						</div>
						<div class="input-field col s4">
							<!--I couldn't get this to work.-->
							<select id='billing_state' name='billing_state'>
								<option value="" disabled selected>Select State/Territory</option>
								<% states.forEach(function(st) { %>
									<option value="<%= st.id %>"><%= st.state %></option>
								<% }); %>
							</select>
						</div>
					</div>
					<div class="row">
						<h5>Shipping Address:</h5>
					</div>
					<div class="row">
						<div class="input-field col s4">
								<input type="checkbox" class="filled-in" id="shipping_is_billing" name="shipping_is_billing" onclick="useBillingInfo()"/>
								<label for="shipping_is_billing">Use Billing Address</label>
						</div>
						<div class="input-field col s2 offset-s1">
							<Label for="shipping_first_name">First Name</Label>
							<input id="shipping_first_name" name=="shipping_first_name" type="text" class="validate"/>
						</div>
						<div class="input-field col s3">
							<Label for="shipping_last_name">Last Name</Label>
							<input id="shipping_last_name" name=="shipping_last_name" type="text" class="validate"/>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s5">
							<Label for="shipping_address">Street Address</Label>
							<input id="shipping_address" name="shipping_address" type="text" class="validate"/>
						</div>
						<div class="input-field col s5">
							<Label for="shipping_city">City</Label>
							<input id="shipping_city" name="shipping_city" type="text" class="validate"/>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s3">
							<Label for="shipping_zip_code">Zip Code</Label>
							<input id="shipping_zip_code" name="shipping_zip_code" type="text" class="validate"/>
						</div>
						<div class="input-field col s2 offset-s1">
							<label>State:</label>
						</div>
						<div class="input-field col s4">
							<!--I couldn't get this to work.-->
							<select id='shipping_state' name='shipping_state'>
								<option value="" disabled selected>Select State/Territory</option>
								<% states.forEach(function(st) { %>
									<option value="<%= st.id %>"><%= st.state %></option>
								<% }); %>
							</select>
						</div>
					</div>
					<div class="row">
						<button class="btn waves-effect waves-light" type="submit" name="action">
							Place Order
							<i class="material-icons right">send</i>
						</button>
					</div>
				</div>
				<div class="col s4">
					<table class="striped">
						<thead>
							<tr>
								<th>Name</th>
								<th>Quantity</th>
								<th>Price</th>
							</tr>
						</thead>
						<tbody class="cartTbody"/>
					</table>
				</div>
			</form>
			</div>
		</div>
	</div>
</body>
</html>
